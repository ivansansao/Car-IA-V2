class Genetic {

    constructor() {
        this.gotCloserBest = 0;
        this.recordCloser = 0;
        this.quantidade = 4;
        this.pesos = '';
        this.shapes = '';
        this.melhor = null;
        this.melhorCorrente = null;
        this.pesos = [];
        this.shapes = '22,8;8;8,9;9';

        // Sem pista.
        this.pesos.push('');

        // Pista 1
        this.pesos.push('-0.16185849905014038,-0.04437238723039627,-1.3237130641937256,0.2876213788986206,-0.385092556476593,0.19724732637405396,0.1237185001373291,-0.06338256597518921,0.2453538477420807,-0.6997166872024536,1.410857081413269,0.32246139645576477,1.199432611465454,-0.4128447473049164,0.32923924922943115,-1.3065760135650635,0.15168942511081696,-0.07108508795499802,-0.17661991715431213,0.07175277173519135,0.23320171236991882,-0.272798627614975,0.7646384835243225,0.09415274113416672,0.06807831674814224,-0.3031100928783417,-0.11551899462938309,-0.020972825586795807,0.30205807089805603,-0.07269393652677536,-0.3349117040634155,0.2952057123184204,-0.47856825590133667,-0.13946513831615448,-0.6110274195671082,1.520184874534607,0.1623045802116394,0.19997701048851013,-0.8235505223274231,0.033160462975502014,0.33578619360923767,1.188737154006958,0.06884343177080154,1.3037086725234985,-0.09796760231256485,-0.12444498389959335,0.28243428468704224,0.5909421443939209,-0.1317303478717804,0.16166268289089203,0.35642683506011963,0.6080654263496399,-0.2894786298274994,-0.09969548135995865,-0.18787556886672974,-0.37247076630592346,0.12478846311569214,-0.9267023205757141,-0.08800050616264343,-0.2457096129655838,-0.12772005796432495,1.0642482042312622,-0.1620897650718689,0.4621514081954956,0.31308260560035706,-0.5343852639198303,-0.3469054400920868,-1.3564386367797852,0.004182605538517237,1.1538372039794922,0.18082450330257416,0.15190252661705017,0.11375369131565094,-0.506252646446228,-0.22739747166633606,-0.07488903403282166,-0.2785661518573761,0.8099858164787292,-0.035846829414367676,0.3080045282840729,0.1827273815870285,-0.6243537664413452,-0.018771793693304062,0.09771919250488281,-0.19458718597888947,-0.07943561673164368,0.24004529416561127,0.8611940145492554,-0.30244868993759155,1.3452447652816772,-0.12320582568645477,0.10487211495637894,0.21837569773197174,0.3406694531440735,-0.1392998844385147,0.2525820732116699,0.23607337474822998,0.3305451571941376,-0.37945234775543213,-0.25492599606513977,0.0682314857840538,-0.46676093339920044,-0.06115955859422684,-0.4739043712615967,0.3452170193195343,-0.31325408816337585,-0.2805209457874298,0.10767737030982971,0.13166068494319916,-0.5030214786529541,-0.0898054987192154,-0.327277272939682,0.41069135069847107,0.0333954393863678,-0.4944550693035126,-0.8328852653503418,0.3848859369754791,0.2575017511844635,0.23008418083190918,0.07410398870706558,0.49757274985313416,0.15810371935367584,0.23505420982837677,-0.572344183921814,0.15884074568748474,-0.10238425433635712,0.042895808815956116,0.33252835273742676,0.1521066427230835,-0.22623111307621002,0.26244229078292847,-0.08588148653507233,-2.720733642578125,-0.2699497938156128,-0.27051666378974915,0.1024727150797844,-0.08318343013525009,0.395197331905365,0.263071745634079,0.39213696122169495,0.29767268896102905,0.10573217272758484,0.7926983833312988,-0.3940197825431824,-0.024865301325917244,-0.32865607738494873,-0.9364618062973022,0.9848143458366394,-1.1595020294189453,0.18676576018333435,-0.019511492922902107,-1.5564467906951904,0.5025249123573303,-1.9183756113052368,0.08134669065475464,-0.5244364738464355,-0.22849886119365692,1.9314978122711182,0.19902153313159943,0.34307563304901123,-0.0020182060543447733,0.057369414716959,0.20125624537467957,-0.3094848394393921,0.27771198749542236,2.1878111362457275,-0.30896443128585815,-0.2018854320049286,0.2460600882768631,-0.1404835730791092,0.15096627175807953,-0.21715256571769714,2.1105048656463623,-0.0990428626537323,-0.02979367785155773,-0.06040643900632858;0,1.2993333339691162,0,-1.5122278928756714,-3.310288667678833,0,1.565291404724121,-0.26443052291870117;-0.9202674627304077,-0.2863459885120392,-0.20264552533626556,0.37124788761138916,0.9039772152900696,-0.9439395666122437,0.46519309282302856,-0.1224612444639206,0.6786810755729675,-1.3760827779769897,0.6986674070358276,0.30998435616493225,-1.4794461727142334,1.0476666688919067,-0.05415308475494385,0.3334486484527588,-0.5312850475311279,0.14023225009441376,-0.00895486120134592,1.935012936592102,0.563092827796936,-1.198738932609558,-1.1154136657714844,-0.3081356883049011,-0.310271292924881,1.5010926723480225,0.026366086676716805,-0.7110133767127991,-0.21397684514522552,1.2848334312438965,-0.6263017654418945,-0.43540990352630615,-2.2851455211639404,0.030620375648140907,0.7560316920280457,-0.1556524783372879,0.6402912139892578,1.818588137626648,0.33993232250213623,0.020111655816435814,-0.37478020787239075,0.8221223950386047,-0.1130407378077507,0.004149127285927534,-0.28086555004119873,1.3128257989883423,-0.744111955165863,0.16395674645900726,0.24335120618343353,1.2483513355255127,-0.552593469619751,-0.24164238572120667,-0.5527985692024231,0.09523453563451767,0.04384663328528404,0.03494676947593689,0.2000545859336853,-0.11365890502929688,-0.5390766263008118,-2.1367790699005127,-0.22851604223251343,1.5211632251739502,0.5813907384872437,-0.19258499145507812,-0.7726640105247498,-0.0587097704410553,-0.3092118501663208,0.9197566509246826,-1.4028240442276,0.4037737548351288,-0.3005206286907196,-0.6232607960700989;-0.1824028640985489,0,-1.6631824970245361,0,1.1417511701583862,0.7440764904022217,-1.6099988222122192,0.5921221971511841,1.3984278440475464');

        // Pista 2
        this.pesos.push('-3.9001851081848145,8.741214752197266,-0.018153347074985504,-2.9715945720672607,2.0364437103271484,2.3535730838775635,5.124792575836182,-0.39964377880096436,-3.2874889373779297,-2.082650899887085,5.3889479637146,8.091273307800293,9.02784538269043,5.820566177368164,5.485805511474609,-11.024953842163086,0.8075110912322998,-1.6400001049041748,-2.2885003089904785,3.279257297515869,-0.8861186504364014,-2.4368999004364014,-2.9236724376678467,-0.8597813844680786,2.247279644012451,-1.5598013401031494,0.3202197849750519,-3.706418514251709,-0.6826674938201904,-1.754015564918518,-0.685608983039856,1.7986801862716675,1.7201176881790161,-1.8787360191345215,0.2887868285179138,-1.4380131959915161,4.183285713195801,-2.550503969192505,1.0493873357772827,-2.757768154144287,0.7968617677688599,-1.5848932266235352,2.030855417251587,1.7478883266448975,5.86276912689209,3.3103904724121094,-0.40822672843933105,1.463046669960022,3.230931520462036,-1.983745813369751,-1.9905338287353516,6.719058513641357,-2.6440727710723877,2.1333396434783936,-0.1296844184398651,4.02582311630249,0.7193115949630737,-1.114093542098999,1.5015959739685059,0.8975921273231506,4.365649700164795,-3.64459228515625,-0.5398236513137817,0.3809796869754791,0.058054082095623016,0.37523749470710754,-0.8052796125411987,-2.230616807937622,-5.201517581939697,3.1009860038757324,2.883068561553955,2.4815313816070557,-1.988223671913147,2.1212069988250732,-1.6750872135162354,-0.651671826839447,1.8014768362045288,-4.664955139160156,4.615339279174805,-1.8956947326660156,-1.137129783630371,0.6297704577445984,-3.5895438194274902,0.9029141068458557,2.8169610500335693,-1.7808696031570435,-0.014595190063118935,-0.512313961982727,1.4245916604995728,0.6140164136886597,-2.070997476577759,0.3370814919471741,2.0987308025360107,0.4597729742527008,-1.0191364288330078,-3.6156768798828125,-1.1492551565170288,0.518166184425354,-1.3401035070419312,-3.9474973678588867,-1.568723201751709,-0.18402762711048126,1.7192434072494507,0.5124384760856628,1.621316909790039,0.8926913142204285,-2.2706472873687744,-1.4092700481414795,2.792546272277832,0.18334494531154633,4.394244194030762,-3.6284313201904297,-1.3406952619552612,1.0584062337875366,-0.19705674052238464,-2.3825294971466064,-0.28489407896995544,-1.0570712089538574,-0.42705824971199036,0.7414947748184204,1.6741358041763306,1.3409042358398438,-1.1793795824050903,0.32132071256637573,-0.8918337225914001,-0.3545471429824829,2.1226694583892822,-0.5482421517372131,-3.459582567214966,2.3622875213623047,2.865931272506714,-0.2534223794937134,-4.44159460067749,1.8422117233276367,0.4554879367351532,-2.3025660514831543,1.0295562744140625,-10.74340534210205,1.4747543334960938,0.35276666283607483,-2.531820297241211,0.6086298227310181,1.102658987045288,0.7933060526847839,-0.6329255700111389,-0.6627240180969238,1.4147802591323853,-1.716599464416504,0.5707257986068726,1.4844248294830322,3.6639347076416016,0.5527721047401428,-1.774304986000061,1.4316701889038086,6.010383129119873,-0.2626350522041321,0.4337106943130493,1.371322751045227,-4.295706272125244,-0.005382290575653315,0.4650399088859558,0.8147099018096924,1.602437973022461,-0.8019157648086548,-1.3563001155853271,-3.2335331439971924,1.9778404235839844,-3.0374176502227783,7.892374038696289,2.2478151321411133,-0.4139915704727173,1.913044810295105,-4.632047653198242,-0.01023808028548956,1.1087899208068848,3.4126434326171875;-0.7116526961326599,-1.5164291858673096,7.209433078765869,-3.6969082355499268,-3.648465871810913,-0.18455292284488678,5.906719207763672,-7.556569576263428;1.9288116693496704,-1.554909586906433,2.8908629417419434,-2.5088553428649902,-7.157953262329102,1.1015275716781616,1.229166030883789,-3.248596429824829,3.005829095840454,0.3520199656486511,3.67881178855896,-0.6406979560852051,1.1483092308044434,13.976465225219727,-1.5717889070510864,-3.680598258972168,-0.5256520509719849,-0.047276247292757034,-1.2214181423187256,4.656002998352051,1.1198076009750366,3.5114243030548096,1.1529901027679443,-0.3776453137397766,-4.001283645629883,-4.364022254943848,2.2445175647735596,3.4387335777282715,0.3782668113708496,0.49253353476524353,2.0704774856567383,-7.141178607940674,2.16919207572937,-3.5332791805267334,-0.08990760892629623,-1.8097072839736938,3.4507253170013428,3.8751578330993652,1.7343122959136963,3.008241891860962,16.119802474975586,-8.022019386291504,8.17443561553955,1.3414252996444702,0.37720978260040283,-0.04577777534723282,-4.276026725769043,1.4951881170272827,2.1829025745391846,-5.3294997215271,7.483516693115234,-0.2671548128128052,-0.7122459411621094,-0.24437987804412842,-3.0268609523773193,1.699565052986145,-3.330554485321045,-3.765092372894287,-0.6730076670646667,-2.0314879417419434,-3.5494818687438965,-0.36589622497558594,1.7743991613388062,-0.8706802129745483,-2.1286849975585938,0.870186984539032,-1.6350489854812622,-4.917987823486328,1.4284809827804565,-0.281607061624527,1.1218163967132568,1.486116886138916;-4.46198034286499,-9.987878799438477,10.755919456481934,-10.425948143005371,-13.995306968688965,-3.5782365798950195,9.57968521118164,0.17407050728797913,4.392227649688721');

        // Pista 3
        this.pesos.push('');        

        // Pista 4 3738
        // this.pesos.push('-4.2871413230896,5.441241264343262,1.9436404705047607,5.145759105682373,2.0025265216827393,0.27068063616752625,4.841249465942383,5.449717998504639,-3.950775146484375,-2.8011879920959473,2.988696336746216,3.33201003074646,6.742833137512207,3.36850905418396,3.51702618598938,-14.388969421386719,0.5793452858924866,-0.32670846581459045,-1.1355748176574707,-0.24465692043304443,-0.37796878814697266,0.30313190817832947,-0.7573069930076599,0.31809258460998535,-0.23566052317619324,0.22452904284000397,-0.3737708032131195,0.1523585170507431,-0.374455988407135,-0.14938755333423615,-0.22802597284317017,0.5883488655090332,1.4553759098052979,-1.8587827682495117,-0.9622200131416321,-2.6230931282043457,1.94431471824646,-0.5284411311149597,-0.3415735065937042,-0.5946303009986877,-1.2076873779296875,-0.4536067545413971,0.42754247784614563,0.6536881327629089,2.3079254627227783,0.5872686505317688,-0.10301085561513901,-1.240747332572937,-0.6190752387046814,-0.9909728169441223,-0.15630260109901428,3.3357439041137695,-3.59100604057312,2.2925610542297363,-1.1361643075942993,2.3768088817596436,-0.7006319761276245,-0.19703464210033417,0.4586108922958374,1.6182365417480469,-0.7652842402458191,-1.5435478687286377,0.06544999033212662,2.1550443172454834,-0.5599197149276733,-0.6684379577636719,-1.1504175662994385,-0.9467366337776184,-1.4497960805892944,1.1614081859588623,0.8738844394683838,1.985323429107666,0.11219396442174911,-0.1438749134540558,0.33123987913131714,0.6169539093971252,-0.8772175312042236,0.054953210055828094,0.3101818859577179,-0.9461374282836914,0.8042998313903809,0.0713750496506691,-0.2932884693145752,0.4125119745731354,0.3570345938205719,0.6919342279434204,0.0547611266374588,-0.1904061883687973,-0.16184473037719727,0.8658655881881714,-0.1897699385881424,1.0531435012817383,-0.6405428051948547,-0.8928956985473633,0.37072473764419556,-0.7204643487930298,-0.333040326833725,-0.0794963613152504,-0.025533156469464302,0.3679727017879486,-1.055118203163147,0.25219011306762695,-0.10282435268163681,0.052337396889925,0.21548523008823395,1.7242401838302612,-0.025030631572008133,-0.5251361727714539,1.2158701419830322,0.35039955377578735,1.0268430709838867,-1.3607758283615112,-0.2551534175872803,-0.7064469456672668,0.6805242896080017,-0.4641839861869812,0.289409875869751,0.16956470906734467,-0.13240817189216614,0.27532514929771423,-3.5128064155578613,-0.20771370828151703,-0.34901073575019836,-0.6610047817230225,-0.8918337225914001,-0.01865844801068306,-0.08590131253004074,-1.2552928924560547,0.12340762466192245,-0.015745986253023148,0.32249942421913147,-0.8103790283203125,-0.7139349579811096,0.25092431902885437,2.2310030460357666,-0.08871468901634216,-0.33796244859695435,-3.811225652694702,0.3337973654270172,0.35276666283607483,-1.6090452671051025,0.2567663788795471,0.06429137289524078,0.3559480905532837,0.057784296572208405,0.038528237491846085,0.25882935523986816,0.5482071042060852,-0.14189064502716064,0.06480046361684799,1.0417007207870483,0.8365424871444702,-0.5923480987548828,2.00319504737854,0.8059912919998169,-0.35389670729637146,0.25993961095809937,1.3710111379623413,-0.38694506883621216,-2.591219663619995,0.3705713152885437,1.791351556777954,0.6982812285423279,0.08517961204051971,-0.9153608679771423,-0.33282729983329773,0.5841181874275208,0.5114564299583435,1.3075145483016968,-0.06833295524120331,-0.32227814197540283,0.6463634967803955,-2.9348723888397217,0.022703753784298897,0.862972617149353,1.9775853157043457;-2.4904122352600098,-0.40509986877441406,1.5059199333190918,0.26639440655708313,-2.708881139755249,0.18236985802650452,2.7440896034240723,-5.69276762008667;-1.317972183227539,-2.142641305923462,1.3805732727050781,-0.5028740167617798,-4.690988540649414,1.0690116882324219,0.950770378112793,0.2106866091489792,0.33229419589042664,-1.839990258216858,1.4383761882781982,-0.11154130846261978,0.1850433498620987,22.63863182067871,-6.865297794342041,-5.233944416046143,0.28660351037979126,-0.1043260395526886,-1.4031096696853638,1.1552776098251343,-0.22706709802150726,0.9850816130638123,-7.548635959625244,-1.8048170804977417,-4.430612087249756,-1.897931694984436,1.3779352903366089,-0.6295878291130066,1.2977617979049683,-0.9718004465103149,0.6027514338493347,-17.807100296020508,-6.152969837188721,-5.046779155731201,0.20004279911518097,-0.1252327263355255,-0.2206614464521408,1.5227727890014648,-0.1875915825366974,-0.1625031679868698,20.1436824798584,-23.1540584564209,6.279661178588867,-0.3134223520755768,-0.1372402161359787,-0.39596715569496155,-4.119634628295898,-0.4060530662536621,0.04767432436347008,-0.5602338910102844,9.329388618469238,-0.9406502842903137,-0.05267972871661186,0.46630391478538513,-1.4343675374984741,0.9473345875740051,-2.583716630935669,1.7518175840377808,-9.353713035583496,-4.100368976593018,0.804480254650116,-2.423649549484253,-0.053003910928964615,-0.04519610106945038,-3.0354270935058594,-2.695020914077759,-0.4938923120498657,0.8328470587730408,-5.071298599243164,-1.575569748878479,-0.48919838666915894,-0.04976518452167511;-8.233647346496582,-9.768257141113281,2.9592576026916504,-3.561361074447632,-21.60726547241211,-16.384201049804688,11.152727127075195,4.8975396156311035,5.683000564575195');
        this.pesos.push('-3.6654577255249023,6.812374591827393,1.9436404705047607,7.818332195281982,1.8532294034957886,-0.7404487133026123,4.359869480133057,0.27286776900291443,0.2542988061904907,-2.0703654289245605,3.304107189178467,0.8835091590881348,4.201483249664307,1.8787598609924316,4.638620853424072,-17.349903106689453,0.5793452858924866,-0.32670846581459045,-1.1355748176574707,-0.24465692043304443,-0.37796878814697266,0.30313190817832947,-0.7573069930076599,0.31809258460998535,-0.23606827855110168,0.22452904284000397,-0.3737708032131195,0.1523585170507431,-0.3589590787887573,-0.14938755333423615,-0.22802597284317017,0.5883488655090332,1.4553759098052979,-1.8587827682495117,-0.9622200131416321,-2.6326887607574463,1.94431471824646,-0.5284411311149597,-0.3415735065937042,-0.584861695766449,-1.2076873779296875,-0.4536067545413971,0.42754247784614563,0.6536881327629089,2.3079254627227783,0.5872686505317688,-0.10301085561513901,-1.240747332572937,-0.6190752387046814,-0.9909728169441223,-0.15630260109901428,3.3357439041137695,-3.5908002853393555,2.2925610542297363,-1.1361643075942993,2.3778889179229736,-0.7006319761276245,0.24022959172725677,0.4555419087409973,1.5697879791259766,-0.7652842402458191,-1.5435478687286377,0.06544999033212662,2.1550443172454834,-0.5599197149276733,-0.6684379577636719,-1.1504175662994385,-0.9467366337776184,-1.4488496780395508,1.1624679565429688,0.8738844394683838,1.985323429107666,0.1079510971903801,-0.13916239142417908,0.33123987913131714,0.6169539093971252,-0.8772175312042236,0.054953210055828094,0.3101818859577179,-0.9532704949378967,0.8042998313903809,0.062016624957323074,-0.2932884693145752,0.4156580865383148,0.3570345938205719,0.6919342279434204,0.0547611266374588,-0.1911875307559967,-0.16184473037719727,0.8658655881881714,-0.1897699385881424,1.0507620573043823,-0.6405428051948547,-0.8928956985473633,0.37072473764419556,-0.7237340211868286,-0.333040326833725,-0.0794963613152504,-0.025533156469464302,0.3679727017879486,-1.055118203163147,0.25219011306762695,-0.10282435268163681,0.053461719304323196,0.21548523008823395,1.722424030303955,-0.025030631572008133,-0.5257530212402344,1.2158701419830322,0.35039955377578735,1.0268430709838867,-1.3607758283615112,-0.2551534175872803,-0.7064469456672668,0.6805242896080017,-0.4641839861869812,0.289409875869751,0.16956470906734467,-0.13240817189216614,0.27614709734916687,-3.5315659046173096,-0.20771370828151703,-0.34901073575019836,-0.6610047817230225,-0.8918337225914001,-0.01865844801068306,-0.08590131253004074,-1.2581405639648438,0.12340762466192245,-0.016403906047344208,0.32249942421913147,-0.8103790283203125,-0.7139349579811096,0.25092431902885437,2.2310030460357666,-0.08871468901634216,-0.33796244859695435,-3.811225652694702,0.3337973654270172,0.35276666283607483,-1.6090452671051025,0.2567663788795471,0.06429137289524078,0.3559480905532837,0.057784296572208405,0.038528237491846085,0.25882935523986816,0.5482071042060852,-0.14189064502716064,0.06480046361684799,1.0417007207870483,0.8365424871444702,-0.5923480987548828,2.00319504737854,0.8059912919998169,-0.3394058644771576,0.25993961095809937,1.3710111379623413,-0.38694506883621216,-2.5944042205810547,0.3705713152885437,1.791351556777954,0.6982812285423279,0.08517961204051971,-0.9153608679771423,-0.33282729983329773,0.5841181874275208,0.5114564299583435,1.3075145483016968,-0.06833295524120331,-0.32227814197540283,0.6463634967803955,-2.934711217880249,0.022703753784298897,0.862972617149353,1.9775853157043457;-1.804028868675232,-5.160699367523193,1.593264102935791,2.752424955368042,2.685460329055786,-0.4700166583061218,3.9812071323394775,-1.9287909269332886;-1.317972183227539,-2.0931310653686523,1.553566813468933,-0.5028740167617798,-1.6875698566436768,-9.182439804077148,1.3144794702529907,0.2106866091489792,0.33229419589042664,-1.839990258216858,1.4383761882781982,-0.2598268985748291,0.19024676084518433,17.860647201538086,3.6385059356689453,-5.297858715057373,0.28660351037979126,-0.1043260395526886,-1.4031096696853638,1.1965759992599487,-0.22699043154716492,0.9850816130638123,-13.16391658782959,6.834230422973633,-4.032984256744385,-1.897931694984436,1.3779352903366089,-0.6295878291130066,1.246000051498413,-0.9718004465103149,0.6027514338493347,-15.53065013885498,-1.2535722255706787,-5.277857303619385,0.20557719469070435,-0.1252327263355255,-0.2206614464521408,1.6286189556121826,-0.2675493657588959,-0.1625031679868698,28.8257999420166,-22.583160400390625,6.280204772949219,-0.3134223520755768,-0.1372402161359787,-0.39596715569496155,-4.119634628295898,-0.19377751648426056,0.04767432436347008,-2.032006025314331,8.426733016967773,-1.1973717212677002,-0.05267972871661186,0.46630391478538513,-1.4343675374984741,0.9676388502120972,-2.5872652530670166,1.7550891637802124,-2.9064671993255615,-4.073522090911865,0.7386777400970459,-2.423793077468872,-0.053003910928964615,-0.04519610106945038,-3.0354270935058594,-2.6422524452209473,-0.4938923120498657,-6.047356605529785,-2.0656559467315674,-0.9085758328437805,-0.48919838666915894,-0.04976518452167511;-11.574151039123535,-5.0282111167907715,-0.4163225591182709,-10.847722053527832,-22.747522354125977,-18.520917892456055,16.287757873535156,7.405012130737305,5.782237529754639');

        // Pista 5
        this.pesos.push('0.26264384388923645,-0.2248823642730713,0.4104709327220917,-0.26587235927581787,0.3490575850009918,-0.39163950085639954,0.12259615212678909,-0.3866935074329376,-0.42024457454681396,0.2857610881328583,0.8645992875099182,-0.0677105262875557,0.011375084519386292,-0.8975483775138855,-0.16079093515872955,0.4106284976005554,-0.17184363305568695,1.0370593070983887,0.12429357320070267,0.16218101978302002,-0.0025575614999979734,0.7136989831924438,0.19876456260681152,-0.5781612396240234,-0.6491377353668213,0.36004260182380676,0.16328586637973785,0.11875446140766144,-0.10688193887472153,1.2237746715545654,-0.09656310081481934,-1.6121563911437988,2.812725782394409,-0.3390829861164093,0.7462557554244995,-0.07478600740432739,0.3756572902202606,0.13392429053783417,0.7142283320426941,0.3482201099395752,0.171987846493721,0.27967536449432373,-0.25145986676216125,0.19116376340389252,0.43886619806289673,-0.0014847679995000362,-0.2666916251182556,-0.13780945539474487,-1.158336877822876,-0.04550580307841301,0.4345242977142334,0.23650510609149933,0.0892387181520462,0.09701575338840485,-0.3240014910697937,1.9812124967575073,0.28046944737434387,-0.4913449287414551,-0.3700881600379944,-2.478785514831543,0.49005603790283203,-0.8930944204330444,0.10148978978395462,-0.02701873891055584,-0.020834026858210564,-0.986239492893219,0.1696774661540985,0.12601427733898163,0.05599410831928253,-0.15428029000759125,-0.24524465203285217,0.8355938196182251,0.9573392868041992,-1.9266300201416016,-0.04831754416227341,-0.40453413128852844,-0.025362392887473106,0.08290476351976395,-0.18714097142219543,1.2581748962402344,-2.9447388648986816,-0.059992291033267975,0.1617758870124817,0.3706623613834381,-0.022846616804599762,0.1970614194869995,0.10893082618713379,-0.10176021605730057,-0.23901022970676422,0.19707044959068298,0.2645987272262573,0.5839200019836426,0.15646085143089294,0.4327167272567749,0.04389844462275505,-1.2656440734863281,-0.34875521063804626,0.34276795387268066,0.04240313917398453,0.13944688439369202,-0.15751470625400543,0.15182264149188995,0.3642091453075409,1.1396199464797974,-0.7945265173912048,0.12771202623844147,-0.2457515299320221,0.24794316291809082,-0.19284677505493164,0.23098626732826233,-0.2838391661643982,-0.12507414817810059,-0.3929949700832367,-0.862851619720459,0.5770540833473206,0.09783920645713806,0.1106395348906517,-0.38403981924057007,-0.15904851257801056,1.5317108631134033,0.9838640689849854,-0.1410718858242035,-0.19085943698883057,-0.4187534749507904,-0.4234347343444824,0.3133249282836914,0.40266042947769165,0.19691982865333557,-0.25567108392715454,-0.19797249138355255,-1.7224093675613403,-0.010345354676246643,0.23473642766475677,0.025976108387112617,0.5869455933570862,-0.29194965958595276,0.04239928349852562,0.5601049661636353,-0.015405764803290367,-0.18983213603496552,0.038434527814388275,-0.021426763385534286,-0.5806084871292114,-0.29347583651542664,-0.2179899364709854,-0.007360851392149925,-0.5942792892456055,0.1886412799358368,-2.3484046459198,-0.24366725981235504,-2.5361175537109375,0.04018377885222435,0.011708583682775497,0.8860054612159729,-0.05972641333937645,-0.2669426202774048,0.25456392765045166,-0.32437267899513245,-0.9231393337249756,0.009672325104475021,0.4303830564022064,-0.42780575156211853,0.1151570975780487,0.29491114616394043,-0.21946601569652557,-0.36752358078956604,1.3093494176864624,0.16737300157546997,-0.6072037816047668,0.23868289589881897,0.15602119266986847,0.35736557841300964,-0.3047082722187042,-0.4885641932487488,-0.37578633427619934,1.3865278959274292;0,-2.284705638885498,0,-1.7471345663070679,0,-1.4301660060882568,0,2.539656639099121;-1.1178237199783325,2.229137897491455,0.20508606731891632,0.3041532635688782,-0.45473021268844604,0.08674914389848709,0.6518391370773315,-0.14668966829776764,1.0436586141586304,-0.24654650688171387,-0.5472851991653442,-0.41154733300209045,0.5088735222816467,-0.36610540747642517,0.1691952645778656,0.2608500123023987,0.44885683059692383,0.3630208373069763,3.188413619995117,0.04889487475156784,0.23460105061531067,0.3855609893798828,-0.04978611692786217,1.7515822649002075,0.3524959683418274,-0.45382824540138245,-1.6322845220565796,-0.8174835443496704,0.24437367916107178,0.04751458019018173,-0.15517041087150574,0.13593639433383942,-0.17284247279167175,-0.1945033222436905,-0.28715381026268005,0.3755475878715515,-0.5417128205299377,0.3839554786682129,-0.26116442680358887,-0.4979479908943176,-0.5970050692558289,0.2465270608663559,-0.41389769315719604,0.02247706986963749,0.46889039874076843,0.5254200100898743,0.5964738726615906,-1.2302076816558838,0.4549117088317871,-0.09733645617961884,0.5257800817489624,-0.24951507151126862,-0.05756426230072975,-0.3478344976902008,0.18194209039211273,-0.2726486325263977,1.27130925655365,0.06282922625541687,-0.29803234338760376,0.3262384831905365,-0.8678346872329712,-0.6451218724250793,-0.15887068212032318,-0.35411834716796875,-0.5905461311340332,0.24487300217151642,0.009749396704137325,0.009869375266134739,-0.5271385312080383,0.26509425044059753,0.1877528727054596,0.2794197201728821;0,0,0,0,-0.041771452873945236,0,0.44573432207107544,-1.0951014757156372,0');

        // Pista 6
        this.pesos.push('');
    }

    firstGeneration() {

        cars = [];

        // Novos
        for (let i = 0; i < quantidade; i++) {
            cars.push(new Car());
        }

        let child = new Car('X');
        let pesos;
        if (pesosForcados != undefined) {
            pesos = this.pesos[pesosForcados];
            console.log(`Pesos da pista ${pesosForcados}`);
        } else {
            pesos = this.pesos[pista.selectedPista];
        }

        if (pesos.length > 0) {
            if (world.startWeightSaved) {
                child.ia.setWeightsFromString(pesos, this.shapes);
            }
        }
        cars.push(child);
        this.melhor = child;

        vivos = cars.length;

    }

    nextGeneration() {

        pista.reset();

        this.calcColocacao();

        if (colocacao.length == 0) {
            this.firstGeneration();
            return

        }

        const lastMelhor = this.melhor;
        
        this.melhor = this.getMelhorCarro();
        this.gotCloserBest = this.getGotCloserBest();
        
        if (this.gotCloserBest > this.recordCloser) {
            this.recordCloser = this.gotCloserBest;            
            console.log('Pesos utilizados na corriga anterior:');
            console.log(lastMelhor.ia.showWeights());
        }

        if (!this.melhor) {
            return
        }
        this.saveWeights(this.melhor);
        
        let date = new Date();
        
        console.log(`**** G${nGeracao + 1}. ${date.getHours()}:${date.getMinutes()} KM: ${this.melhor.km} M: ${this.melhor.marca} Queb: ${this.melhor.timer} Ran: ${this.melhor.ranhurasColetadas.length} Perto: ${this.gotCloserBest} Muts: ${this.melhor.ia.mutated} NM: ${this.melhor.ia.mutatedNeurons}`);
        
        //  f1: ${this.melhor.ia.f1} f2: ${this.melhor.ia.f2} 

        if (this.melhor.ranhurasColetadas.length > record) {
            foo.speak(`Atingiu ${this.melhor.ranhurasColetadas.length}!`);
            record = this.melhor.ranhurasColetadas.length;
        }

        if (this.melhor.km < pista.recordKm || this.melhor.ranhurasColetadas.length > pista.recordRanhuras) {

            pista.recordKm = this.melhor.km;
            pista.recordRanhuras = this.melhor.ranhurasColetadas.length;

            if (nGeracao > 0) {
                foo.speak(`quilômetro ${pista.recordKm.toFixed(0)}!`);
            }
            this.melhor.ia.showWeights();
        }

        // pista.pistaTimeOut = ceil(this.melhor.aliveTime *1.1);

        evolucao.push(this.melhor);

        nGeracao++;
        hue = 0;

        cars = [];

        const weights = this.melhor.ia.model.getWeights();

        const weightCopies = [];
        for (let i = 0; i < weights.length; i++) {
            weightCopies[i] = weights[i].clone();
        }

        // Clonado e mutado.
        for (let i = 1; i < (quantidade / 3) * 0; i++) {

            let child = new Car('m');
            child.ia.model.setWeights(weightCopies);
            child.ia.mutate(0.1,1); // 0.1
            cars.push(child);

        }

        // Clonado e mutado.
        for (let i = 1; i < (quantidade / 3) * 3; i++) {

            let child = new Car('T');
            child.ia.model.setWeights(weightCopies);
            child.ia.mutate(0.05); // 0.1
            cars.push(child);

        }

        // Clonado (elitismo)
        if (elitism) {

            let child = new Car('c');
            child.ia.model.setWeights(weightCopies);
            cars.push(child);
        }

        vivos = cars.length;

    }

    setFlag() {

        if (pista) {
            const tmpMelhor = genetic.getMelhorCarro();
            if (tmpMelhor) {
                pista.setFlag(tmpMelhor.pos.x, tmpMelhor.pos.y, tmpMelhor.km);
                this.melhorCorrente = tmpMelhor;
            }
        }

    }

    getQuemMaisDeuReh(qtd) {

        console.log(`Primeiro: ${colocacao[0].km}`);

        let maiorReh = 0;
        let maiorI = 0;

        for (let i = 0; i < min(qtd, colocacao.length); i++) {

            car = colocacao[i];

            console.log(`${i}:  ${colocacao[i].km} -> ${colocacao[i].qtdReh}`);

            if (car.km > 0) {
                if (myRelu(colocacao[i].qtdReh) > maiorReh) {

                    maiorReh = myRelu(colocacao[i].qtdReh);
                    maiorI = i;
                }
            }
        }

        console.log('******* Maior ré é ->', colocacao[maiorI].qtdReh, ' km ', colocacao[maiorI].km, ' i: ', maiorI);
        return colocacao[maiorI];

    }

    getGotCloserBest() {

        let qtd = 0;

        if (this.melhor) {            
            for (const car of cars) {
                if (this.melhor.id != car.id) {
                    if (abs(this.melhor.km - car.km) < 100) {
                        qtd++;
                    }
                }
            }
        }

        return qtd;

    }

    getMelhorCarro() {

        
        let melhor = null;
        let km = Infinity;
        let maisRanhuras = 0;
        let lap = 0;
        let maisMuts = 0;

        // Seleciona a maior volta.
        for (const car of cars) {
            if (car.lap > lap) {
                lap = car.lap;
            }
        }

        // Mais perto do final da pista

        for (const car of cars) {

            if (car.km > 0 && car.lap == lap) {
                if (car.km < km && car.timer < pista.pistaTimeOut) {
                    km = car.km;
                    melhor = car;
                }
            }
        }

        // Carros com mais mutações.

        for (const car of cars) {

            if (car.km == km && car.lap == lap) {
                if (car.ia.mutated > maisMuts) {
                    maisMuts = car.ia.mutated;
                    melhor = car;                    
                }
                
            }
        }

        if (false) {
            
            for (const car of cars) {
    
                if (car.ranhurasColetadas.length > maisRanhuras) {
                    maisRanhuras = car.ranhurasColetadas.length;
                    melhor = car;
                }
            }
    
            if (maisRanhuras < 7 && pista.selectedPista == 2) {

                // Se empate, verifica desses qual tem melhor ângulo.

                let maiorHea = 0;

                for (const car of cars) {
                    if (car.ranhurasColetadas.length == maisRanhuras) {
                        if (car.heading > maiorHea) {
                            maiorHea = car.heading;
                            melhor = car;
                        }
                    }
                }

            } else {

                // Se empate, verifica desses qual tem melhor km.

                let maisKm = Infinity;

                for (const car of cars) {
                    if (car.ranhurasColetadas.length == maisRanhuras) {
                        if (car.km > 0) {
                            if (car.km < maisKm) {
                                maisKm = car.km;
                                melhor = car;
                            }
                        }
                    }
                }
            }
        }

        //  // Se empate, soteia um.
        //  for (const car of cars) {
        //      if (car.ranhurasColetadas.length == maisRanhuras) {
        //          if (random(1) > 0.5) {
        //              melhor = car;
        //              break;
        //          }
        //      }
        //  }

        // console.log('Mais KM() -> ', this.melhor.km, ' maisRanhuras: ', maisRanhuras, ' maisKm: ', maisKm);
        // fill(0,0,255);
        // circle(this.melhor.pos.x,this.melhor.pos.y,8);
        // noLoop();


        return melhor;
    }

    funcSalvarMelhorCarro(melhor) {
        if (salvarMelhorCarro) {
            // localStorage.setItem('meuGato', 'Tom');

            // document.cookie = "username=ivan; expires=Thu, 18 Dec 2025 12:00:00 UTC; path=/";

            // try {
            //     console.log('Salvando carro... ', this.melhor.marca);
            //     await this.melhor.ia.model.save('indexeddb://caria-melhor');
            //     console.log('Salvo');
            //     // await this.melhor.ia.model.save('localstorage://caria-melhor');
            // } catch (err) {
            //     console.error(err);
            // }
        }
    }

    funcCarregarCarroSalvo() {
        if (carregarCarroSalvo) {
            // console.log(' leitura: ',localStorage.getItem('meuGato'));
            // console.log('cookie => ',document.cookie);
            // try {

            //     console.log('Carregando carro salvo...');
            //     const melhorSalvo = await tf.loadLayersModel('indexeddb://caria-melhor');

            //     let child = new Car('X');
            //     child.ia.model = null;
            //     child.ia.model = melhorSalvo
            //     cars.push(child);

            // } catch (err) {
            //     console.error(err);
            // }
            // melhorCarregado = true;
            // console.log('Carregado!')
        }

    }
    saveWeights(car) {
        const w = car.ia.showWeights(true);
        localStorage.setItem('melhor', w);
    }

    calcColocacao() {
        colocacao = [];
        for (let car of cars) {
            colocacao.push(car);
        }
        if (colocacao.length > 0) {
            colocacao.sort(function (a, b) { return b.km < a.km });
        }

    }


}